<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Questionário Psicossocial</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<form method="POST">

    <div class="cards-container">

        {% for id, texto, escala_key in perguntas %}
        <div class="pergunta-card">

            <p class="pergunta-texto">
                <strong>{{ loop.index }})</strong> {{ texto }}
            </p>

            {# ===============================
               PERGUNTAS COPSOQ NORMAIS
               =============================== #}
            {% if escala_key != "evento" %}
            <div class="opcoes">
                {% set opcoes = ESCALAS.get(escala_key, []) %}
                {% for texto_opcao, valor in opcoes %}
                <label class="opcao">
                    <input
                        type="radio"
                        name="pergunta_{{ id }}"
                        value="{{ valor }}"
                        required
                    >
                    {{ texto_opcao }}
                </label>
                {% endfor %}
            </div>
            {% endif %}

            {# ===============================
               PERGUNTAS DE EVENTO CRÍTICO
               =============================== #}
            {% if escala_key == "evento" %}
            <div class="opcoes">
                {% for texto_opcao, valor in ESCALAS["evento"] %}
                <label class="opcao">
                    <input
                        type="radio"
                        name="pergunta_{{ id }}"
                        value="{{ valor }}"
                        data-pergunta="{{ id }}"
                        onchange="verificarEvento(this)"
                        required
                    >
                    {{ texto_opcao }}
                </label>
                {% endfor %}
            </div>

            <div
                id="evento_{{ id }}"
                class="evento-condicional"
                style="display:none; margin-left:20px;"
            >
                <p style="margin-top:10px;"><strong>De quem?</strong></p>

                <label>
                    <input type="checkbox" name="origem_{{ id }}" value="colega">
                    Colega
                </label><br>

                <label>
                    <input type="checkbox" name="origem_{{ id }}" value="gestor">
                    Gestor
                </label><br>

                <label>
                    <input type="checkbox" name="origem_{{ id }}" value="subordinado">
                    Subordinado
                </label><br>

                <label>
                    <input type="checkbox" name="origem_{{ id }}" value="cliente">
                    Cliente
                </label>
            </div>
            {% endif %}

        </div>
        {% endfor %}

    </div>

    <button type="submit" class="btn-enviar">Enviar</button>

</form>

<script>
function verificarEvento(el) {
    const perguntaId = el.dataset.pergunta;
    const bloco = document.getElementById("evento_" + perguntaId);

    if (!bloco) return;

    if (parseInt(el.value) > 0) {
        bloco.style.display = "block";
    } else {
        bloco.style.display = "none";
        bloco.querySelectorAll("input[type=checkbox]").forEach(cb => cb.checked = false);
    }
}
</script>

</body>
</html>